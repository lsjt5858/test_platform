# æµ‹è¯•å¹³å°æ ¸å¿ƒæ¶æ„è¡¥å……å®Œæˆæ€»ç»“

## é¡¹ç›®æ¦‚è¿°

åŸºäºæ‚¨æä¾›çš„æ¡†æ¶è®¾è®¡ï¼Œæˆ‘å·²ç»å®Œæˆäº†æµ‹è¯•å¹³å°Coreå±‚çš„ç³»ç»Ÿåœ°åŸºå»ºè®¾ï¼Œæ‰“é€ äº†ä¸€ä¸ªå®Œæ•´çš„å››å±‚æ¶æ„æµ‹è¯•å¹³å°ï¼š

```
Core (åŸºç¡€è®¾æ–½å±‚) -> App (APIå°è£…å±‚) -> Biz (ä¸šåŠ¡ç¼–æ’å±‚) -> Test (æµ‹è¯•ç”¨ä¾‹å±‚)
```

## å·²å®Œæˆçš„æ ¸å¿ƒæ¨¡å—

### 1. base_util - åŸºç¡€å·¥å…·æ¨¡å—
- **logger.py**: ç»Ÿä¸€æ—¥å¿—ç®¡ç†ï¼Œæ”¯æŒæ–‡ä»¶å’Œæ§åˆ¶å°è¾“å‡º
- **retry_util.py**: é‡è¯•æœºåˆ¶ï¼Œæ”¯æŒæŒ‡æ•°é€€é¿å’Œè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†
- **wait_util.py**: ç­‰å¾…å·¥å…·ï¼Œæ”¯æŒæ¡ä»¶ç­‰å¾…å’Œè¶…æ—¶æ§åˆ¶
- **file_util.py**: æ–‡ä»¶æ“ä½œå·¥å…·ï¼Œæ”¯æŒJSON/YAML/æ–‡æœ¬æ–‡ä»¶è¯»å†™
- **exception_handler.py**: è‡ªå®šä¹‰å¼‚å¸¸ç±»ä½“ç³»
- **singleton.py**: çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼å®ç°
- **upload_util.py**: æ–‡ä»¶ä¸Šä¼ å·¥å…·ï¼Œæ”¯æŒS3ç­‰äº‘å­˜å‚¨

### 2. config - é…ç½®ç®¡ç†æ¨¡å—
- **config_loader.py**: å¢å¼ºç‰ˆé…ç½®åŠ è½½å™¨
  - æ”¯æŒå¤šç§æ ¼å¼ï¼šINIã€JSONã€YAML
  - æ”¯æŒç¯å¢ƒå˜é‡æ³¨å…¥
  - æ”¯æŒå¤šç¯å¢ƒé…ç½®åˆ‡æ¢
  - æä¾›å…¨å±€é…ç½®å•ä¾‹

### 3. db - æ•°æ®åº“æ“ä½œæ¨¡å—
- **base_db_handler.py**: æ•°æ®åº“æ“ä½œåŸºç±»
- **mysql_handler.py**: MySQLæ“ä½œå°è£…
  - è¿æ¥æ± ç®¡ç†
  - äº‹åŠ¡æ”¯æŒ
  - é‡è¯•æœºåˆ¶
  - æ‰¹é‡æ“ä½œ
- **redis_handler.py**: Redisæ“ä½œå°è£…
  - JSONåºåˆ—åŒ–æ”¯æŒ
  - å“ˆå¸Œå’Œåˆ—è¡¨æ“ä½œ
  - è¿‡æœŸæ—¶é—´ç®¡ç†
- **elasticsearch_handler.py**: Elasticsearchæ“ä½œå°è£…
  - ç´¢å¼•ç®¡ç†
  - æ‰¹é‡ç´¢å¼•
  - å¤æ‚æŸ¥è¯¢æ”¯æŒ

### 4. protocol - åè®®å°è£…æ¨¡å—
- **http_client.py**: å¢å¼ºç‰ˆHTTPå®¢æˆ·ç«¯
  - è¯·æ±‚/å“åº”é’©å­
  - é‡è¯•ç­–ç•¥
  - è¯·æ±‚å†å²è¿½è¸ª
  - å“åº”éªŒè¯
- **auth_handler.py**: è®¤è¯å¤„ç†å™¨
  - æ”¯æŒBasicã€Bearerã€OAuth2ã€API Keyç­‰è®¤è¯æ–¹å¼
  - ä»¤ç‰Œç¼“å­˜å’Œè‡ªåŠ¨åˆ·æ–°
  - HMACç­¾åç”Ÿæˆ
- **curl_util.py**: cURLå·¥å…·
  - å‘½ä»¤ç”Ÿæˆå’Œæ‰§è¡Œ
  - ä¸requestsæ ¼å¼äº’è½¬

### 5. mq - æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å—
- **base_mq_handler.py**: æ¶ˆæ¯é˜Ÿåˆ—åŸºç±»
- **kafka_handler.py**: Kafkaæ“ä½œå°è£…
  - ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ”¯æŒ
  - ä¸»é¢˜ç®¡ç†
  - æ‰¹é‡æ¶ˆæ¯å¤„ç†
  - æŒç»­æ¶ˆè´¹æ¨¡å¼
- **rabbitmq_handler.py**: RabbitMQæ“ä½œå°è£…
  - äº¤æ¢æœºå’Œé˜Ÿåˆ—ç®¡ç†
  - æ¶ˆæ¯è·¯ç”±
  - æŒä¹…åŒ–é…ç½®

### 6. pytest_util - æµ‹è¯•å·¥å…·æ¨¡å—
- **assertions.py**: åŸæœ‰æ–­è¨€å·¥å…·
- **enhanced_assertions.py**: å¢å¼ºæ–­è¨€å·¥å…·
  - HTTPå“åº”æ–­è¨€
  - JSONè·¯å¾„æ–­è¨€
  - æ•°æ®åº“æ–­è¨€
  - å¼‚æ­¥ç­‰å¾…æ–­è¨€
- **fixtures.py**: é€šç”¨pytestå›ºä»¶
- **test_runner.py**: æµ‹è¯•è¿è¡Œå™¨
- **data_generator.py**: æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨

### 7. ui_util - UIè‡ªåŠ¨åŒ–æ¨¡å—
- **webdriver_factory.py**: WebDriverå·¥å‚
  - å¤šæµè§ˆå™¨æ”¯æŒ
  - é…ç½®åŒ–é©±åŠ¨åˆ›å»º
  - é©±åŠ¨å®ä¾‹ç®¡ç†
- **page_base.py**: é¡µé¢å¯¹è±¡åŸºç±»
  - é€šç”¨é¡µé¢æ“ä½œ
  - å…ƒç´ ç­‰å¾…æœºåˆ¶
  - æˆªå›¾åŠŸèƒ½
- **element_locator.py**: å…ƒç´ å®šä½å™¨
- **ui_assertions.py**: UIä¸“ç”¨æ–­è¨€

## æ–°å¢æ€§èƒ½ç›‘æ§æ¨¡å—

### performance/ ç›®å½•
- **k6_runner.py**: K6æ€§èƒ½æµ‹è¯•è¿è¡Œå™¨
  - åŠ¨æ€è„šæœ¬ç”Ÿæˆ
  - æµ‹è¯•æ‰§è¡Œå’Œç»“æœè§£æ
  - æ€§èƒ½åˆ†æå’ŒæŠ¥å‘Š
- **prometheus_client.py**: Prometheuså®¢æˆ·ç«¯
  - æŒ‡æ ‡æŸ¥è¯¢
  - èŒƒå›´æŸ¥è¯¢
  - æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- **grafana_dashboard.py**: Grafanaä»ªè¡¨ç›˜ç®¡ç†
  - è‡ªåŠ¨åˆ›å»ºæ€§èƒ½ç›‘æ§ä»ªè¡¨ç›˜
  - æ•°æ®æºç®¡ç†
  - ä»ªè¡¨ç›˜å¯¼å…¥å¯¼å‡º
- **performance_analyzer.py**: æ€§èƒ½åˆ†æå™¨
  - ç»“æœåˆ†æå’Œè¯„åˆ†
  - æ€§èƒ½å›å½’æ£€æµ‹
  - HTML/JSONæŠ¥å‘Šç”Ÿæˆ

## é›†æˆç‰¹æ€§

### K6 + Prometheus + Grafana æ€§èƒ½ç›‘æ§æ ˆ
1. **K6æ€§èƒ½æµ‹è¯•**: è‡ªåŠ¨åŒ–è´Ÿè½½æµ‹è¯•è„šæœ¬ç”Ÿæˆå’Œæ‰§è¡Œ
2. **PrometheusæŒ‡æ ‡æ”¶é›†**: å®æ—¶æ€§èƒ½æŒ‡æ ‡å­˜å‚¨
3. **Grafanaå¯è§†åŒ–**: è‡ªåŠ¨åŒ–ä»ªè¡¨ç›˜åˆ›å»ºå’Œå±•ç¤º
4. **æ€§èƒ½åˆ†æ**: è‡ªåŠ¨åŒ–æ€§èƒ½åˆ†æå’Œå›å½’æ£€æµ‹

### ç»Ÿä¸€é…ç½®ç®¡ç†
- å¤šç¯å¢ƒæ”¯æŒï¼ˆtest/staging/productionï¼‰
- ç¯å¢ƒå˜é‡æ³¨å…¥
- å¤šæ ¼å¼é…ç½®æ–‡ä»¶æ”¯æŒ

### å…¨é¢é”™è¯¯å¤„ç†
- è‡ªå®šä¹‰å¼‚å¸¸ä½“ç³»
- è¯¦ç»†é”™è¯¯æ—¥å¿—
- é‡è¯•æœºåˆ¶

### å¯æ‰©å±•æ¶æ„
- æ’ä»¶åŒ–è®¾è®¡
- æ¥å£æŠ½è±¡
- ä¾èµ–æ³¨å…¥

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€HTTPå®¢æˆ·ç«¯ä½¿ç”¨
```python
from core.src.core.protocol import HttpClient, RequestConfig
from core.src.core.config import get_config

config = get_config()
client = HttpClient(base_url=config.get("API", "base_url"))
response = client.get("/api/users")
```

### æ•°æ®åº“æ“ä½œ
```python
from core.src.core.db import MySQLHandler

db_config = {...}
with MySQLHandler(db_config) as db:
    users = db.execute_query("SELECT * FROM users WHERE active = %s", (True,))
```

### æ€§èƒ½æµ‹è¯•
```python
from performance import K6Runner, K6Config

config = K6Config(
    virtual_users=50,
    duration="5m",
    script_path="test_script.js"
)
runner = K6Runner(config)
results = runner.run_k6_test()
```

### UIè‡ªåŠ¨åŒ–
```python
from core.src.core.ui_util import WebDriverFactory, BrowserConfig, BasePage

config = BrowserConfig(browser="chrome", headless=True)
driver = WebDriverFactory.create_driver(config)
page = BasePage(driver, "https://example.com")
page.navigate_to("/login")
```

## é¡¹ç›®ç»“æ„
```
test_platform/
â”œâ”€â”€ core/src/core/           # æ ¸å¿ƒåŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ base_util/          # åŸºç¡€å·¥å…·
â”‚   â”œâ”€â”€ config/             # é…ç½®ç®¡ç†  
â”‚   â”œâ”€â”€ db/                 # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ protocol/           # åè®®å°è£…
â”‚   â”œâ”€â”€ mq/                 # æ¶ˆæ¯é˜Ÿåˆ—
â”‚   â”œâ”€â”€ pytest_util/       # æµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ ui_util/            # UIè‡ªåŠ¨åŒ–
â”œâ”€â”€ performance/            # æ€§èƒ½ç›‘æ§æ¨¡å—
â”‚   â”œâ”€â”€ k6_runner.py
â”‚   â”œâ”€â”€ prometheus_client.py
â”‚   â”œâ”€â”€ grafana_dashboard.py
â”‚   â””â”€â”€ performance_analyzer.py
â”œâ”€â”€ app/                    # APIå°è£…å±‚ï¼ˆå·²å­˜åœ¨ï¼‰
â”œâ”€â”€ biz/                    # ä¸šåŠ¡ç¼–æ’å±‚ï¼ˆå·²å­˜åœ¨ï¼‰
â”œâ”€â”€ test/                   # æµ‹è¯•ç”¨ä¾‹å±‚ï¼ˆå·²å­˜åœ¨ï¼‰
â””â”€â”€ config/                 # é…ç½®æ–‡ä»¶ç›®å½•
```

## æŠ€æœ¯ç‰¹æ€§

### ğŸš€ é«˜æ€§èƒ½
- è¿æ¥æ± ç®¡ç†
- å¼‚æ­¥æ”¯æŒ
- æ‰¹é‡æ“ä½œä¼˜åŒ–

### ğŸ”§ æ˜“ç»´æŠ¤
- æ¨¡å—åŒ–è®¾è®¡
- æ¸…æ™°çš„åˆ†å±‚æ¶æ„
- å®Œå–„çš„æ—¥å¿—è®°å½•

### ğŸ›¡ï¸ é«˜å¯é 
- é‡è¯•æœºåˆ¶
- é”™è¯¯å¤„ç†
- å¥åº·æ£€æŸ¥

### ğŸ“Š å¯è§‚æµ‹
- æ€§èƒ½ç›‘æ§
- æŒ‡æ ‡æ”¶é›†
- å®æ—¶ä»ªè¡¨ç›˜

## åç»­å»ºè®®

1. **æ·»åŠ å•å…ƒæµ‹è¯•**: ä¸ºæ¯ä¸ªæ¨¡å—æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•
2. **æ–‡æ¡£å®Œå–„**: æ·»åŠ è¯¦ç»†çš„APIæ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—
3. **CI/CDé›†æˆ**: é…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹
4. **ç›‘æ§å‘Šè­¦**: é…ç½®Prometheuså‘Šè­¦è§„åˆ™
5. **æ‰©å±•App/Bizå±‚**: åŸºäºæ–°çš„Coreå±‚èƒ½åŠ›æ‰©å±•ä¸Šå±‚ä¸šåŠ¡é€»è¾‘

## ä¾èµ–åŒ…

ä¸»è¦ä¾èµ–åŒ…å·²åœ¨requirements.txtä¸­å®šä¹‰ï¼ŒåŒ…æ‹¬ï¼š
- requests, urllib3: HTTPå®¢æˆ·ç«¯
- pymysql, redis, elasticsearch: æ•°æ®åº“é©±åŠ¨
- kafka-python, pika: æ¶ˆæ¯é˜Ÿåˆ—å®¢æˆ·ç«¯
- selenium: UIè‡ªåŠ¨åŒ–
- pytest: æµ‹è¯•æ¡†æ¶
- faker, jsonschema: æ•°æ®ç”Ÿæˆå’ŒéªŒè¯

Coreå±‚çš„ç³»ç»Ÿåœ°åŸºå·²ç»æ­å»ºå®Œæˆï¼Œä¸ºæ•´ä¸ªæµ‹è¯•å¹³å°æä¾›äº†åšå®çš„åŸºç¡€è®¾æ–½æ”¯æ’‘ã€‚