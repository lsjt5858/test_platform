# ğŸ” æ€§èƒ½ç›‘æ§æŸ¥çœ‹æŒ‡å—

## ğŸ“Š å„ç»„ä»¶è®¿é—®åœ°å€

| ç»„ä»¶ | åœ°å€ | ç”¨é€” | ç™»å½•ä¿¡æ¯ |
|------|------|------|----------|
| **Prometheus** | http://localhost:9090 | æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢ | æ— éœ€ç™»å½• |
| **Grafana** | http://localhost:3000 | æ•°æ®å¯è§†åŒ–ä»ªè¡¨æ¿ | admin/admin |
| **Pushgateway** | http://localhost:9091 | K6æ•°æ®æ¨é€ä¸­è½¬ | æ— éœ€ç™»å½• |

---

## ğŸ¯ Prometheus æ•°æ®æŸ¥çœ‹

### 1. è®¿é—® Graph é¡µé¢
```
URL: http://localhost:9090/graph
```

### 2. å¸¸ç”¨ K6 æŸ¥è¯¢è¯­å¥

#### ğŸ“ˆ åŸºç¡€æŒ‡æ ‡
```promql
# å½“å‰è™šæ‹Ÿç”¨æˆ·æ•°
k6_vus

# æœ€å¤§è™šæ‹Ÿç”¨æˆ·æ•°
k6_vus_max

# HTTP è¯·æ±‚æ€»æ•°
k6_http_reqs

# HTTP å“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
k6_http_req_duration
```

#### ğŸ” é«˜çº§åˆ†ææŸ¥è¯¢
```promql
# HTTP é”™è¯¯ç‡ï¼ˆè¿‡å»5åˆ†é’Ÿï¼‰
rate(k6_http_req_failed[5m]) * 100

# å¹³å‡å“åº”æ—¶é—´
avg(k6_http_req_duration)

# 95åˆ†ä½æ•°å“åº”æ—¶é—´
quantile(0.95, k6_http_req_duration)

# æŒ‰çŠ¶æ€ç åˆ†ç»„çš„è¯·æ±‚æ•°
sum by (status) (k6_http_reqs)

# æŒ‰URLåˆ†ç»„çš„å¹³å‡å“åº”æ—¶é—´
avg by (url) (k6_http_req_duration)
```

### 3. æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æŒ‡æ ‡
```
URL: http://localhost:9090/targets
æ£€æŸ¥ Pushgateway ç›®æ ‡çŠ¶æ€æ˜¯å¦ä¸º UP
```

---

## ğŸ“ˆ Grafana ä»ªè¡¨æ¿é…ç½®

### 1. é¦–æ¬¡è®¿é—®è®¾ç½®

#### è®¿é—® Grafana
```
URL: http://localhost:3000
ç”¨æˆ·å: admin
å¯†ç : admin
```

#### éªŒè¯æ•°æ®æº
1. ç‚¹å‡»å·¦ä¾§ âš™ï¸ **Configuration** â†’ **Data sources**
2. åº”è¯¥çœ‹åˆ° **Prometheus** æ•°æ®æº
3. ç‚¹å‡» **Test** æŒ‰é’®éªŒè¯è¿æ¥

### 2. åˆ›å»º K6 æ€§èƒ½ä»ªè¡¨æ¿

#### æ·»åŠ æ–°ä»ªè¡¨æ¿
1. ç‚¹å‡» **+** â†’ **Dashboard** â†’ **Add new panel**

#### æ¨èé¢æ¿é…ç½®

##### ğŸ“Š Panel 1: HTTP è¯·æ±‚æ•°
```
Title: HTTP Requests
Query: k6_http_reqs
Visualization: Stat
```

##### ğŸ“Š Panel 2: å“åº”æ—¶é—´è¶‹åŠ¿
```
Title: Response Time Trend
Query: k6_http_req_duration
Visualization: Time series
Unit: milliseconds (ms)
```

##### ğŸ“Š Panel 3: è™šæ‹Ÿç”¨æˆ·æ•°
```
Title: Virtual Users
Query: k6_vus
Visualization: Time series
```

##### ğŸ“Š Panel 4: é”™è¯¯ç‡
```
Title: Error Rate
Query: rate(k6_http_req_failed[5m]) * 100
Visualization: Gauge
Unit: percent (0-100)
Max: 100
```

##### ğŸ“Š Panel 5: å“åº”æ—¶é—´åˆ†å¸ƒ
```
Title: Response Time Distribution
Query: histogram_quantile(0.95, k6_http_req_duration)
Visualization: Stat
```

### 3. ä¿å­˜ä»ªè¡¨æ¿
1. ç‚¹å‡»å³ä¸Šè§’ ğŸ’¾ **Save dashboard**
2. å‘½åä¸º "K6 Performance Dashboard"

---

## ğŸš€ Pushgateway æ•°æ®æŸ¥çœ‹

### è®¿é—® Pushgateway
```
URL: http://localhost:9091
```

### æŸ¥çœ‹æ¨é€çš„æŒ‡æ ‡
1. **ä¸»é¡µé¢**: æ˜¾ç¤ºæ‰€æœ‰æ¨é€çš„æŒ‡æ ‡ç»„
2. **Metrics ç«¯ç‚¹**: http://localhost:9091/metrics
   - æŸ¥çœ‹åŸå§‹ Prometheus æ ¼å¼æ•°æ®
   - éªŒè¯ K6 æ•°æ®æ˜¯å¦æˆåŠŸæ¨é€

### æ¨é€çŠ¶æ€éªŒè¯
```bash
# æŸ¥çœ‹æ¨é€çš„ K6 æŒ‡æ ‡
curl http://localhost:9091/metrics | grep k6_
```

---

## ğŸ“Š æ€§èƒ½æ•°æ®è§£è¯»æŒ‡å—

### ğŸ¯ å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼ˆKPIï¼‰

#### 1. **å“åº”æ—¶é—´æŒ‡æ ‡**
| æŒ‡æ ‡ | å«ä¹‰ | å¥½/åé˜ˆå€¼ |
|------|------|-----------|
| `k6_http_req_duration` | HTTPè¯·æ±‚å“åº”æ—¶é—´ | <500ms å¥½, >2s å·® |
| `k6_http_req_waiting` | æœåŠ¡å™¨å¤„ç†æ—¶é—´ | <300ms å¥½, >1s å·® |
| `k6_http_req_blocked` | å»ºç«‹è¿æ¥æ—¶é—´ | <100ms å¥½, >500ms å·® |

#### 2. **ååé‡æŒ‡æ ‡**
| æŒ‡æ ‡ | å«ä¹‰ | å‚è€ƒå€¼ |
|------|------|--------|
| `k6_http_reqs` | è¯·æ±‚æ€»æ•° | è¶Šé«˜è¶Šå¥½ |
| `rate(k6_http_reqs[1m])` | æ¯ç§’è¯·æ±‚æ•°(RPS) | å–å†³äºé¢„æœŸ |

#### 3. **é”™è¯¯ç‡æŒ‡æ ‡**
| æŒ‡æ ‡ | å«ä¹‰ | é˜ˆå€¼ |
|------|------|------|
| `k6_http_req_failed` | å¤±è´¥è¯·æ±‚ç‡ | <1% å¥½, >5% å·® |
| `k6_checks` | æ–­è¨€é€šè¿‡ç‡ | 100% ç†æƒ³ |

#### 4. **è´Ÿè½½æŒ‡æ ‡**
| æŒ‡æ ‡ | å«ä¹‰ | è¯´æ˜ |
|------|------|------|
| `k6_vus` | å½“å‰è™šæ‹Ÿç”¨æˆ·æ•° | æµ‹è¯•è´Ÿè½½å¤§å° |
| `k6_iterations` | å®Œæˆçš„è¿­ä»£æ•° | æµ‹è¯•æ‰§è¡Œé‡ |

### ğŸ” æ€§èƒ½åˆ†æè¦ç‚¹

#### âœ… è‰¯å¥½æ€§èƒ½ç‰¹å¾
- å“åº”æ—¶é—´ç¨³å®šä¸”ä½
- é”™è¯¯ç‡æ¥è¿‘0%
- ååé‡æ»¡è¶³éœ€æ±‚
- èµ„æºåˆ©ç”¨ç‡åˆç†

#### âš ï¸ æ€§èƒ½é—®é¢˜ä¿¡å·
- å“åº”æ—¶é—´æ³¢åŠ¨å¤§
- é”™è¯¯ç‡çªç„¶ä¸Šå‡
- ååé‡è¾¾åˆ°ç“¶é¢ˆ
- è¶…æ—¶è¯·æ±‚å¢å¤š

#### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®
1. **å“åº”æ—¶é—´é«˜**: ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ã€ç¼“å­˜ç­–ç•¥
2. **é”™è¯¯ç‡é«˜**: æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€ã€å®¹é‡è§„åˆ’
3. **ååé‡ä½**: æ‰©å±•èµ„æºã€è´Ÿè½½å‡è¡¡ä¼˜åŒ–

---

## ğŸ”„ æŒç»­ç›‘æ§å·¥ä½œæµ

### 1. æ‰§è¡Œæµ‹è¯•
```bash
./run_perf.sh
```

### 2. æ•°æ®æµéªŒè¯
1. **Pushgateway**: ç¡®è®¤æ•°æ®æ¨é€æˆåŠŸ
2. **Prometheus**: éªŒè¯æŒ‡æ ‡å¯æŸ¥è¯¢
3. **Grafana**: æŸ¥çœ‹å¯è§†åŒ–ç»“æœ

### 3. æ€§èƒ½åˆ†æ
1. æŸ¥çœ‹å…³é”®æŒ‡æ ‡è¶‹åŠ¿
2. è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
3. å¯¹æ¯”å†å²åŸºçº¿æ•°æ®

### 4. ç»“æœåˆ¤æ–­
- âœ… æ€§èƒ½è¾¾æ ‡: ç»§ç»­ç›‘æ§
- âš ï¸ æ€§èƒ½ä¸‹é™: åˆ†ææ ¹å› 
- âŒ æ€§èƒ½ä¸è¾¾æ ‡: ä¼˜åŒ–å’Œé‡æµ‹

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. Grafana æ— æ³•æŸ¥è¯¢åˆ°æ•°æ®
```bash
# æ£€æŸ¥ Prometheus è¿æ¥
curl http://localhost:9090/api/v1/query?query=k6_vus

# æ£€æŸ¥æ•°æ®æºé…ç½®
# Grafana â†’ Configuration â†’ Data sources â†’ Prometheus
```

#### 2. Pushgateway ä¸­æ²¡æœ‰æ•°æ®
```bash
# æ£€æŸ¥ K6 æ¡¥æ¥è„šæœ¬
docker-compose run --rm k6-bridge

# æŸ¥çœ‹æ¨é€çŠ¶æ€
curl http://localhost:9091/metrics | grep k6_
```

#### 3. Prometheus æŠ“å–å¤±è´¥
```bash
# æ£€æŸ¥ Targets çŠ¶æ€
curl http://localhost:9090/targets
```

### é‡æ–°è¿è¡Œæµ‹è¯•
```bash
# æ¸…ç†å¹¶é‡æ–°å¼€å§‹
docker-compose down
./run_perf.sh
```